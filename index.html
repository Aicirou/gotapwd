<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Got a pwd for you!</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap");
      body {
        font-family: "Open Sans", sans-serif;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }
      #container {
        background-color: #fff;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        text-align: center;
        width: 250px;
        height: 150px;
        zoom: 275%;
      }
      h1 {
        color: black;
        font-family: "Roboto Mono", monospace;
        font-size: 16px;
        text-size-adjust: 100%;
      }
      #password {
        margin: 10px auto;
        padding: 10px;
        font-size: 14px;
        border: 1px dotted #ccc;
        border-radius: 20px;
        width: 180px;
        text-align: center;
        outline: none;
        font-weight: 600;
      }
      .uppercase {
        color: #11120f;
      }
      .lowercase {
        color: #1cd400;
      }
      .number {
        color: blue;
      }
      .symbol {
        color: #e81123;
      }
      #refreshButton {
        background-color: black;
        color: white;
        border: none;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        font-size: 24px;
        cursor: pointer;
        transition: background-color 0.3s, transform 0.3s; /* Added transform transition */
      }
      #refreshButton:hover {
        background-color: black;
        border: 5px solid rgb(70, 19, 19);
      }
      .rotate {
        transform: rotate(-180deg); /* Added rotate transform */
      }
      #copyMessage {
        font-size: 10px;
        color: #777;
        margin-top: 5px;
        display: block;
      }
      #countTypes {
        font-size: 10px;
        color: #777;
        margin-top: 5px;
        display: block;
      }
    </style>
  </head>
  <body>
    <div id="container">
      <h1>Got a pwd for me?</h1>
      <p id="password" readonly></p>
      <!-- <br /> -->
      <button id="refreshButton">&#8634;</button>
      <small id="countTypes"></small>
      <small id="copyMessage" hidden></small>
    </div>

    <script>
      function generatePassword() {
        const characterSet = {
          uppercase: "ABCDEFGHIJKLMNOPQRSTUVWXYZ",
          lowercase: "abcdefghijklmnopqrstuvwxyz",
          number: "0123456789",
          symbol: "!@#$%^&*([{_;:,.?/<'>}])",
        };

        let password = "";
        const passwordLength = 21;
        // Helper function to get a random character from a given character set.
        function getRandomCharacter(charSet) {
          return charSet.charAt(Math.floor(Math.random() * charSet.length));
        }
        // Ensure at least one character from each category is included, fill the rest with random characters.
        for (let i = 0; i < passwordLength; i++) {
          if (i % 4 == 0 && i < passwordLength - 4) {
            for (const type in characterSet) {
              password += getRandomCharacter(characterSet[type]);
            }
          }
        }
        // Fill the rest of the password with random characters.
        for (let i = password.length; i < passwordLength; i++) {
          let randomType =
            Object.keys(characterSet)[
              Math.floor(Math.random() * Object.keys(characterSet).length)
            ];
          password += getRandomCharacter(characterSet[randomType]);
        }

        // Function to shuffle a string randomly.
        function shuffleString(string) {
          return string
            .split("")
            .sort(() => Math.random() - 0.5)
            .join("");
        }
        // Shuffle the password to make it more random.
        password = shuffleString(password);

        document.getElementById("password").textContent = password;
        updatePasswordStyle(password);
        document.getElementById("copyMessage").textContent = "";
      }

      function updatePasswordStyle(password) {
        var passwordElement = document.getElementById("password");
        const characterTypes = {
          uppercase: /[A-Z]/,
          lowercase: /[a-z]/,
          number: /\d/,
          symbol: /[^A-Za-z0-9]/,
        };
        let countTypes = {};

        // Style the password based on character types
        let styledPassword = "";
        for (const char of password) {
          let charClass = "";
          for (const type in characterTypes) {
            if (characterTypes[type].test(char)) {
              charClass = type;
              countTypes[type] = countTypes[type] + 1 || 1;
              break;
            }
          }
          styledPassword += `<span class="${charClass}">${char}</span>`;
        }

        passwordElement.innerHTML = styledPassword;
        document.getElementById("countTypes").textContent = `Uppercase: ${
          countTypes.uppercase || 0
        }, Lowercase: ${countTypes.lowercase || 0}, Number: ${
          countTypes.number || 0
        }, Symbol: ${countTypes.symbol || 0}`;
      }

      function copyToClipboard() {
        // var copyText = document.getElementById("password");
        // copyText.select();
        // copyText.setSelectionRange(0, 99999);
        // document.execCommand("copy");
        var range = document.createRange();
        range.selectNode(document.getElementById("password"));
        window.getSelection().removeAllRanges(); // Clear previous selections
        window.getSelection().addRange(range); // Select the text
        document.execCommand("copy"); // Copy the selected text
        document.getElementById("copyMessage").textContent =
          "Password copied to clipboard!";
        setTimeout(() => {
          document.getElementById("copyMessage").textContent = "";
          window.getSelection().removeAllRanges(); // Clear previous selections
        }, 1000);
      }

      // Generate password on page load
      generatePassword();

      // Button event listener
      document
        .getElementById("refreshButton")
        .addEventListener("click", function () {
          generatePassword();
          document.getElementById("refreshButton").classList.add("rotate");
          setTimeout(() => {
            document.getElementById("refreshButton").classList.remove("rotate");
          }, 100);
        });

      // Copy password on click
      document
        .getElementById("password")
        .addEventListener("click", function () {
          copyToClipboard();
          document.getElementById("countTypes").textContent = "";
        });
    </script>
  </body>
</html>
